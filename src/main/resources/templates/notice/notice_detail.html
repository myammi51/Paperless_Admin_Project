<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title th:text="${dto != null ? dto.title : '공지사항 상세'}">공지사항 상세</title>
  <link rel="stylesheet" th:href="@{/admin/css/admin.css}" />
  <link rel="stylesheet" th:href="@{/notice/css/notice.css}" />
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
</head>

<body>
  <div class="container">
    <header th:replace="~{fragments/topbar :: topbar}"></header>
    <aside th:replace="~{fragments/sidebar :: sidebar}"></aside>

    <main class="main" role="main">
      <div class="page-header" style="display:flex;justify-content:space-between;align-items:center;">
        <h1 class="page-title" style="margin:0;">
          <span class="badge badge--pinned" th:if="${dto?.isPinned == 'Y'}">상단</span>
          <span th:text="${dto?.title}">공지 제목</span>
        </h1>

        <a class="btn primary" th:href="@{|/admin/notice_edit/${dto.noticeId}|}">수정</a>
      </div>

      <div class="card section">
        <div class="meta-line">
          <span
            th:text="${dto?.createdAt != null ? #temporals.format(dto.createdAt, 'yyyy-MM-dd HH:mm') : '-'}">-</span>
          <span>
            작성자:
            <b class="admin-name" th:attr="data-admin-id=${dto?.adminId}"
              th:text="${dto?.adminId != null ? 'ID ' + dto.adminId : '-'}">-</b>
          </span>
          <span>조회: <b th:text="${dto?.viewCount != null ? dto.viewCount : 0}">0</b></span>
        </div>
      </div>

      <div class="card section" style="min-height:160px;">
        <div class="prose" th:utext="${#strings.escapeXml(dto?.content)?.replaceAll('\n','<br/>')}">
          본문
        </div>
      </div>

      <div class="card section" th:if="${files != null and !#lists.isEmpty(files)}">
        <h2 class="page-title" style="font-size:15px; margin-bottom:8px;">첨부파일</h2>
        <ul class="attach-list">
          <li th:each="f : ${files}">
            <a th:href="${f.url}" th:text="${f.filename}">첨부파일명</a>
          </li>
        </ul>
      </div>

      <div class="nav-row" th:if="${prev != null or next != null}">
        <a class="btn sm" th:if="${prev != null}" th:href="@{|/admin/notice_detail/${prev.noticeId}|}"
          th:text="${'이전: ' + prev.title}">
          이전
        </a>
        <span th:if="${prev == null}"></span>

        <a class="btn sm" th:if="${next != null}" th:href="@{|/admin/notice_detail/${next.noticeId}|}"
          th:text="${'다음: ' + next.title}">
          다음
        </a>
      </div>

      <div class="actions">
        <a class="btn" th:href="@{/admin/notice}">목록으로</a>
      </div>
    </main>
  </div>

  <script>
    (function () {
      document.querySelectorAll('.nav a').forEach(a => a.classList.remove('active'));
      const current = document.querySelector('.nav a[href="/admin/notice"]');
      if (current) current.classList.add('active');
    })();

    (function () {
      const MAP = { 1: "관리자A", 2: "관리자B", 3: "관리자C" };
      const el = document.querySelector('.admin-name');
      if (!el) return;
      const id = el.getAttribute('data-admin-id');
      if (id && id !== 'null') el.textContent = MAP[id] ?? ("ID " + id);
      else el.textContent = '-';
    })();
  </script>
</body>

</html>